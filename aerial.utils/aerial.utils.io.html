<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>aerial.utils.io documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Aerial.utils</span> <span class="project-version">1.0.9</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Topics</span></h3><ul><li class="depth-1 "><a href="intro.html"><div class="inner"><span>Introduction to utils</span></div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>aerial</span></div></div></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>utils</span></div></div></li><li class="depth-3 branch"><a href="aerial.utils.coll.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>coll</span></div></a></li><li class="depth-3"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>ds</span></div></div></li><li class="depth-4 branch"><a href="aerial.utils.ds.bktrees.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>bktrees</span></div></a></li><li class="depth-4 branch"><a href="aerial.utils.ds.graphs.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>graphs</span></div></a></li><li class="depth-4"><a href="aerial.utils.ds.trees.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>trees</span></div></a></li><li class="depth-3 branch current"><a href="aerial.utils.io.html"><div class="inner"><span class="tree" style="top: -114px;"><span class="top" style="height: 123px;"></span><span class="bottom"></span></span><span>io</span></div></a></li><li class="depth-3"><a href="aerial.utils.math.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>math</span></div></a></li><li class="depth-4 branch"><a href="aerial.utils.math.clustering.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>clustering</span></div></a></li><li class="depth-4 branch"><a href="aerial.utils.math.combinatorics.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>combinatorics</span></div></a></li><li class="depth-4 branch"><a href="aerial.utils.math.infoth.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>infoth</span></div></a></li><li class="depth-4 branch"><a href="aerial.utils.math.probs-stats.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>probs-stats</span></div></a></li><li class="depth-4"><a href="aerial.utils.math.scores.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>scores</span></div></a></li><li class="depth-3 branch"><a href="aerial.utils.misc.html"><div class="inner"><span class="tree" style="top: -176px;"><span class="top" style="height: 185px;"></span><span class="bottom"></span></span><span>misc</span></div></a></li><li class="depth-3"><a href="aerial.utils.string.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>string</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="aerial.utils.io.html#var--.3EauioReader"><div class="inner"><span>-&gt;auioReader</span></div></a></li><li class="depth-1"><a href="aerial.utils.io.html#var-add-rdrwtr"><div class="inner"><span>add-rdrwtr</span></div></a></li><li class="depth-1"><a href="aerial.utils.io.html#var-assemble-bindings"><div class="inner"><span>assemble-bindings</span></div></a></li><li class="depth-1"><a href="aerial.utils.io.html#var-auio-rdrs"><div class="inner"><span>auio-rdrs</span></div></a></li><li class="depth-1"><a href="aerial.utils.io.html#var-close-stream"><div class="inner"><span>close-stream</span></div></a></li><li class="depth-1"><a href="aerial.utils.io.html#var-do-text-file"><div class="inner"><span>do-text-file</span></div></a></li><li class="depth-1"><a href="aerial.utils.io.html#var-do-text-to-text"><div class="inner"><span>do-text-to-text</span></div></a></li><li class="depth-1"><a href="aerial.utils.io.html#var-fd-use"><div class="inner"><span>fd-use</span></div></a></li><li class="depth-1"><a href="aerial.utils.io.html#var-force-gc-finalize"><div class="inner"><span>force-gc-finalize</span></div></a></li><li class="depth-1"><a href="aerial.utils.io.html#var-get-xform-body-bindings"><div class="inner"><span>get-xform-body-bindings</span></div></a></li><li class="depth-1"><a href="aerial.utils.io.html#var-get-xform-rdrwrtr-bindings"><div class="inner"><span>get-xform-rdrwrtr-bindings</span></div></a></li><li class="depth-1"><a href="aerial.utils.io.html#var-letio"><div class="inner"><span>letio</span></div></a></li><li class="depth-1"><a href="aerial.utils.io.html#var-map-.3EauioReader"><div class="inner"><span>map-&gt;auioReader</span></div></a></li><li class="depth-1"><a href="aerial.utils.io.html#var-nss-set"><div class="inner"><span>nss-set</span></div></a></li><li class="depth-1"><a href="aerial.utils.io.html#var-open-streaming-gzip"><div class="inner"><span>open-streaming-gzip</span></div></a></li><li class="depth-1"><a href="aerial.utils.io.html#var-process-line"><div class="inner"><span>process-line</span></div></a></li><li class="depth-1"><a href="aerial.utils.io.html#var-rdrwtrs-set"><div class="inner"><span>rdrwtrs-set</span></div></a></li><li class="depth-1"><a href="aerial.utils.io.html#var-read-lines"><div class="inner"><span>read-lines</span></div></a></li><li class="depth-1"><a href="aerial.utils.io.html#var-read-stream"><div class="inner"><span>read-stream</span></div></a></li><li class="depth-1"><a href="aerial.utils.io.html#var-reduce-file"><div class="inner"><span>reduce-file</span></div></a></li><li class="depth-1"><a href="aerial.utils.io.html#var-rwfl-syms"><div class="inner"><span>rwfl-syms</span></div></a></li><li class="depth-1"><a href="aerial.utils.io.html#var-with-in-reader"><div class="inner"><span>with-in-reader</span></div></a></li><li class="depth-1"><a href="aerial.utils.io.html#var-with-out-append-writer"><div class="inner"><span>with-out-append-writer</span></div></a></li><li class="depth-1"><a href="aerial.utils.io.html#var-with-out-writer"><div class="inner"><span>with-out-writer</span></div></a></li><li class="depth-1"><a href="aerial.utils.io.html#var-write-lines"><div class="inner"><span>write-lines</span></div></a></li><li class="depth-1"><a href="aerial.utils.io.html#var-write-stream"><div class="inner"><span>write-stream</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">aerial.utils.io</h1><div class="doc"><pre class="plaintext">Various supplementary I/O functions and macros. Some new, some
recapitulations of previous extremely useful functionality that is
no longer included in the standard Clojure ecosystem.</pre></div><div class="public anchor" id="var--.3EauioReader"><h3>-&gt;auioReader</h3><div class="usage"><code>(-&gt;auioReader fspec rdr)</code></div><div class="doc"><pre class="plaintext">Positional factory function for class aerial.utils.io.auioReader.
</pre></div></div><div class="public anchor" id="var-add-rdrwtr"><h3>add-rdrwtr</h3><div class="usage"><code>(add-rdrwtr rw)</code><code>(add-rdrwtr rw use-auioRdr)</code></div><div class="doc"><pre class="plaintext">Add the symbol RW to the set of reader and writer operations letio
will look for and handle.</pre></div></div><div class="public anchor" id="var-assemble-bindings"><h3>assemble-bindings</h3><div class="usage"><code>(assemble-bindings bv-fds bvec body-fds deps)</code></div><div class="doc"><pre class="plaintext">Assemble the fd-bindings created from the original binding vector,
the original binding vector bindings, and the fd-bindings created
from the letio body. Basically need to ensure an ordering such that
any values required in the fds-* bindings are placed above those
bindings and above their using forms of fds-* bindings are placed
below those bindings.</pre></div></div><div class="public anchor" id="var-auio-rdrs"><h3>auio-rdrs</h3><div class="usage"></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-close-stream"><h3>close-stream</h3><div class="usage"><code>(close-stream strm)</code></div><div class="doc"><pre class="plaintext">Close the i/o stream strm.
</pre></div></div><div class="public anchor" id="var-do-text-file"><h3>do-text-file</h3><h4 class="type">macro</h4><div class="usage"><code>(do-text-file [in &amp; options] &amp; body)</code></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-do-text-to-text"><h3>do-text-to-text</h3><h4 class="type">macro</h4><div class="usage"><code>(do-text-to-text [in out] &amp; body)</code></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-fd-use"><h3>fd-use</h3><div class="usage"><code>(fd-use)</code></div><div class="doc"><pre class="plaintext">Returns count of current file descriptors held.  Often (typically)
this can be larger (indeed, _much_ larger) than the count actually
being used.  This is due to the fact that things like io/read-lines
or equivalent will not close the file unless it is read in
entirety.  There are many cases where reading only the first few
lines is what is needed.  Further, reading them all just to get a
few is completely loses all advantage of lazy evaluation (not to
mention possible memory blow up)

*** NOTE: (bug!) UNIX only.  Uses /proc/&lt;pid&gt;/fd to determine all
    descriptors currently held by the process (the JVM here).
</pre></div></div><div class="public anchor" id="var-force-gc-finalize"><h3>force-gc-finalize</h3><div class="usage"><code>(force-gc-finalize)</code></div><div class="doc"><pre class="plaintext">Tries to force a GC in order to finalize no longer used OS
resources - in particular file descriptors (see fd-use).

*** NOTE: as described by System.gc(), which we use here, this may
    or may not actually accomplish the task at hand as it is only a
    'suggestion' to the collector to run.  If it does run, all no
    longer used resoureces should be finalized, i.e., closed and
    returned.
</pre></div></div><div class="public anchor" id="var-get-xform-body-bindings"><h3>get-xform-body-bindings</h3><div class="usage"><code>(get-xform-body-bindings body deps)</code></div><div class="doc"><pre class="plaintext">Walk sexps in body and for each that satisfiles rdrwtrs? and nss?,
lift the corresponding reader / writer to a binding pair (gensym'd
symbol with r/w value) and replace the r/w subexpr with the binding
var. Returns a pair [fds xbody], where fds is a binding vector of
the new bindings (could be empty) and the xform'd body.</pre></div></div><div class="public anchor" id="var-get-xform-rdrwrtr-bindings"><h3>get-xform-rdrwrtr-bindings</h3><div class="usage"><code>(get-xform-rdrwrtr-bindings bvec)</code></div><div class="doc"><pre class="plaintext">Transform the binding vector bvec by reaching into any value
form (right hand side of pair) which has a reader or writer form (as
from clojure.javas.io) and lifting that form out, creating a binding
for it (with a gensym for the fd bind symbol - left hand side of
binding). Top level reader or writer bindings are left as is. Any
read-lines binding or use in a subform, has its argument lifted into
an explicit reader binding. Returns the xformed binding vector.</pre></div></div><div class="public anchor" id="var-letio"><h3>letio</h3><h4 class="type">macro</h4><div class="usage"><code>(letio bindings &amp; body)</code></div><div class="doc"><pre class="plaintext">Like let, but will close all file descriptors opened in the
bindings (and implicitly in body) and will check for certain lazy
readers and will reach into the call and pull out the designated
file, create a binding of a reader for it to a generated sym, and
replace the file in the call with the sym.</pre></div></div><div class="public anchor" id="var-map-.3EauioReader"><h3>map-&gt;auioReader</h3><div class="usage"><code>(map-&gt;auioReader m__6522__auto__)</code></div><div class="doc"><pre class="plaintext">Factory function for class aerial.utils.io.auioReader, taking a map of keywords to field values.
</pre></div></div><div class="public anchor" id="var-nss-set"><h3>nss-set</h3><div class="usage"></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-open-streaming-gzip"><h3>open-streaming-gzip</h3><div class="usage"><code>(open-streaming-gzip fspec io)</code></div><div class="doc"><pre class="plaintext">Open a gziped file stream on file given by file specification
fspec (a string). The input/output mode is given by io: :in for
input (reading), :out for output (writing)</pre></div></div><div class="public anchor" id="var-process-line"><h3>process-line</h3><div class="usage"><code>(process-line acc line)</code></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-rdrwtrs-set"><h3>rdrwtrs-set</h3><div class="usage"></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-read-lines"><h3>read-lines</h3><div class="usage"><code>(read-lines f)</code></div><div class="doc"><pre class="plaintext">Lazily read lines from text file f by creating a lazying seq over a
buffered reader.  Will automatically close the reader after all
lines are read, but will leak the associated file descriptor if the
returned lazy seq is dropped before file is fully consumed.  Hence,
this should always be used inside a letio block</pre></div></div><div class="public anchor" id="var-read-stream"><h3>read-stream</h3><div class="usage"><code>(read-stream instrm buf)</code></div><div class="doc"><pre class="plaintext">Read a the next (binary) chunk from input stream instrm into byte
buffer buf. NOTE: this _modifies_ buf!</pre></div></div><div class="public anchor" id="var-reduce-file"><h3>reduce-file</h3><div class="usage"><code>(reduce-file fname func acc)</code></div><div class="doc"><pre class="plaintext">Reduce text file denoted by FNAME (filespec/File obj) using
function FUNC per line and reduction seed accumulator ACC.  FUNC is
a function of two arguments: first is the current line from file
and second is the current value of ACC.</pre></div></div><div class="public anchor" id="var-rwfl-syms"><h3>rwfl-syms</h3><div class="usage"></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-with-in-reader"><h3>with-in-reader</h3><h4 class="type">macro</h4><div class="usage"><code>(with-in-reader f &amp; body)</code></div><div class="doc"><pre class="plaintext">Opens a PushbackReader on f, binds it to *in*, and evaluates body.
</pre></div></div><div class="public anchor" id="var-with-out-append-writer"><h3>with-out-append-writer</h3><h4 class="type">macro</h4><div class="usage"><code>(with-out-append-writer f &amp; body)</code></div><div class="doc"><pre class="plaintext">Like with-out-writer but appends to file.
</pre></div></div><div class="public anchor" id="var-with-out-writer"><h3>with-out-writer</h3><h4 class="type">macro</h4><div class="usage"><code>(with-out-writer f &amp; body)</code></div><div class="doc"><pre class="plaintext">Opens a writer on f, binds it to *out*, and evalutes body.
Anything printed within body will be written to f.</pre></div></div><div class="public anchor" id="var-write-lines"><h3>write-lines</h3><div class="usage"><code>(write-lines f lines)</code></div><div class="doc"><pre class="plaintext">Writes lines (a collection of strings) to f, separated by newlines.
f is opened with writer, and automatically closed at the end of the
sequence.</pre></div></div><div class="public anchor" id="var-write-stream"><h3>write-stream</h3><div class="usage"><code>(write-stream otstrm data)</code></div><div class="doc"><pre class="plaintext">Write a chunk of output data to output stream otstrm. data is
typically a byte buffer representing whatever data is being written.</pre></div></div></div></body></html>